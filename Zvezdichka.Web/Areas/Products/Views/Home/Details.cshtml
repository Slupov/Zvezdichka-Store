@using Zvezdichka.Web.Infrastructure.Constants
@model Zvezdichka.Web.Areas.Products.Models.ProductDetailsViewModel
@{
    ViewData["Title"] = "Details";
    var newCommentMessage = "";
}

<div class="row">
    <div class="product-container col-xs-12">
        <div class="row">
            <div id="product-images" class="col-xs-12 col-sm-6 col-md-4">
                <div class="thumbnails-wrapper">
                    <div class="alternate-images col-md-6">
                        @*                    show alternate images*@
                        <ul id="piThumbList" class="col-xs-4 col-sm-12">
                            @foreach (var img in Model.ImageSources)
                            {
                                <li class="col-sm-12">
                                    <img src="@img.Source" class="img-responsive thumbnail-image"/>
                                </li>
                            }
                        </ul>
                    </div>
                    <div id="productImageContainer" class="col-md-6">
                        @*                    show main image*@
                        @if (Model.ImageSources.Count > 0)
                        {
                            <img src="@Model.ImageSources.First().Source" id="main-image" class="img-responsive"/>
                        }
                    </div>
                </div>
            </div>
            <div id="product-alldetails" class="col-xs-12 col-sm-6 col-md-4">
                <div class="col-xs-12 title">
                    <h3>
                        @Model.Name
                    </h3>
                </div>
                <div class="col-xs-12 price">
                    @Model.Price leva.
                </div>
                <div class="col-xs-12 product-details">
                    @Html.Raw(@Model.Description)
                </div>
                <div class="col-xs-12 product-categories">
                    Categories:
                    <ul>
                        @foreach (var category in Model.Categories)
                        {
                            <li>@category</li>
                        }
                    </ul>
                </div>
            </div>
        </div>


    </div>
</div>

<div>

    @if (User.Identity.IsAuthenticated)
    {
        //        Shopping
        <div class="form-group row">
            <div class="col-xs-2">
                <input type="number" id="bag-quantity" class="form-control"/>
            </div>
            <div>
                <a class="btn btn-success" onclick="addToCart('@Model.Name')">Add to Cart</a>
            </div>
            <div>
                <a asp-area="Shopping" asp-controller="Home" asp-action="Index" class="btn btn-default">Cart</a>
            </div>
        </div>

        //         Comments
        <div class="form-group" id="add-comment-div">
            <label class="control-label">Message:</label>
            <textarea id="add-message-content" name="add-message-content"></textarea>
        </div>

        <div class="form-group">
            <a onclick="addComment('@Model.Id', '@User.Identity.Name')" class="btn btn-default">Add Comment</a>
        </div>
    }

    <h3>Comments</h3>

    <div class="comments-container">
        <table class="table table-responsive" id="comments-table">
            <tr>
                <th>User</th>
                <th>Message</th>
                <th></th>
            </tr>

            @foreach (var comment in Model.Comments)
            {
                <tr>
                    <td>
                        @comment.User.UserName

                        <div>
                            @if (@comment.IsEdited)
                            {
                                <div>
                                    <i>Edited on @comment.DateEdited</i>
                                </div>
                                <div>
                                    <i>Originaly added on @comment.DateEdited</i>
                                </div>
                            }
                            else
                            {
                                <p>Added on @comment.DateAdded</p>
                            }

                        </div>
                    </td>
                    <td>
                        @Html.Raw(comment.Message)
                    </td>
                    <td>
                        @if (comment.User.UserName == User.Identity.Name)
                        {
                            <div class="row">
                                <a class="btn btn-danger col-xs-5" onclick="deleteComment(this,'@comment.Id')">X</a>
                                <a class="btn btn-primary col-xs-offset-1 col-xs-6" onclick="editComment('@comment.Id')">Edit</a>
                            </div>
                        }
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

<div>
    @if (User.IsInRole("Admin") || User.IsInRole("Manager"))
    {
        <a asp-route="@WebConstants.Routes.ProductEdit" asp-route-id="@Model.Id" asp-route-title="@Model.Name">Edit</a>
        @Html.Raw("| ")
    }
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts{
    <script type="text/javascript">
        addCkEditor("add-message-content", "comment-form");
        changeThumbnailOnHover();
    </script>
}